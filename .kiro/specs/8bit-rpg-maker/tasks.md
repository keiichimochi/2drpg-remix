# Implementation Plan

- [x] 1. プロジェクト基盤セットアップ
  - Remix v3プロジェクト作成、TypeScript設定、基本ディレクトリ構造構築
  - Prisma導入、SQLite設定、基本データモデル定義
  - 基本的なルーティング構造（/editor, /api）を作成
  - _Requirements: 1.1, 1.2_

- [x] 2. データベースモデルとマイグレーション実装
  - Project, Map, Tileset, Sprite, Locale, Flag, AIGenerationJobモデルをPrismaスキーマで定義
  - 初期マイグレーション作成と実行
  - 基本的なCRUD操作のサーバーサイド関数を実装
  - _Requirements: 1.2, 9.1_

- [x] 3. ファイルアップロードとストレージシステム
  - 画像アップロードAPI（/api/upload）を実装
  - ファイルハッシュ計算とバリデーション機能
  - ローカル開発用ストレージとS3互換ストレージの抽象化レイヤー
  - _Requirements: 3.1, 3.2_

- [x] 4. PixiJS基盤とレンダリングシステム
  - @pixi/reactでPixi Applicationコンポーネント作成
  - NEAREST scaleMode設定、8ビット風レンダリング設定
  - 基本的なContainer構造（terrain, collision, decoration layers）
  - _Requirements: 2.1, 8.3, 11.1_

- [x] 5. タイルセット管理システム
  - PNGタイルシートの16×16自動スライス機能
  - タイルパレットUIコンポーネント
  - 安定ID管理システムとハッシュベース重複検出
  - _Requirements: 3.1, 3.2_

- [x] 6. マップエディタ基本機能
  - レイヤー管理UI（追加/削除/順序変更/可視性切替）
  - グリッド表示とズーム機能（0.5×〜8×）
  - 基本的なマップデータ構造とレンダリング
  - _Requirements: 2.1, 2.2_

- [x] 7. タイル描画ツール実装
  - ペイント、消しゴム、矩形塗り、バケツツールの実装
  - マウス/タッチ入力ハンドリング
  - リアルタイムプレビューとタイル配置
  - _Requirements: 2.1, 2.2_

- [x] 8. 衝突判定と領域管理システム
  - 衝突レイヤーの可視化機能
  - 領域タグシステム（encounter, damage等）の実装
  - タイル単位および矩形での衝突設定UI
  - _Requirements: 5.1, 5.2_

- [ ] 9. スプライトとアニメーション管理
  - スプライトアップロードとフレーム定義UI
  - 歩行アニメーション（上下左右、各3フレーム以上）の設定
  - FPS調整可能なアニメーションシステム
  - _Requirements: 4.1, 4.2_

- [ ] 10. イベントノードエディタ基盤
  - ノードベースエディタのUI実装
  - 基本ノード（Talk, IfFlag, SetFlag, Warp, GiveItem, StartBattle）の実装
  - ノードグラフのJSON保存/読み込み機能
  - _Requirements: 6.1, 6.2_

- [ ] 11. イベントシステムとマップ連携
  - マップ上へのイベント配置機能
  - 座標ベースのイベント紐付けシステム
  - イベント実行エンジンの基本実装
  - _Requirements: 6.3_

- [ ] 12. ローカライゼーションシステム
  - 多言語キー管理システム（デフォルト日本語）
  - 変数埋め込み（{playerName}等）機能
  - ダイアログプレビュー機能
  - _Requirements: 7.1, 7.2_

- [ ] 13. プレビュー・プレイモードの実装
  - 同一画面内でのゲームプレビュー機能
  - キーボード入力（矢印/WASD、スペース）ハンドリング
  - 衝突判定、イベント起動、マップ遷移の動作実装
  - 30/60FPS切替機能
  - _Requirements: 8.1, 8.2_

- [ ] 14. 自動保存とUndo/Redoシステム
  - 5秒間隔の自動保存機能（デバウンス付き）
  - 50ステップのUndo/Redoスタック実装
  - 競合検出と差分表示機能
  - _Requirements: 9.1, 9.2_

- [ ] 15. プロジェクトエクスポート/インポート機能
  - JSON+アセットZIPエクスポート機能
  - プロジェクト構造の整合性保証
  - 安定ID維持でのインポート機能
  - _Requirements: 10.1, 10.2_

- [ ] 16. AIタイル生成システム基盤
  - Google Gemini APIクライアント初期化（Imagen 3 / Gemini 2.x対応）
  - AI生成ジョブ管理システム（非同期処理、進捗追跡）
  - responseModalities設定とモデル切替機能
  - _Requirements: 13.2, 13.8_

- [ ] 17. AIタイル生成UI実装
  - カテゴリ、パレット、シード、バリエーション数の入力フォーム
  - 進捗表示UI（待機→生成→整形→検証→完了）
  - エラーハンドリングとリトライ機能
  - _Requirements: 13.1_

- [ ] 18. 画像生成と8ビット風整形処理
  - Gemini/Imagen APIを使った画像生成機能
  - パレット量子化（8/16/32色）とディザリング
  - 16×16グリッドでの自動スライス機能
  - _Requirements: 13.2, 13.3_

- [ ] 19. オートタイルとシームレス処理
  - Wangタイル/マーチングスクエア互換の接続パターン検出
  - 境界誤差評価とシームレス品質スコア算出
  - オートタイル配置の自動並べ替え機能
  - _Requirements: 13.4_

- [ ] 20. AIタイル分類とタグ付けシステム
  - 画像特徴とプロンプトからの自動タグ推定
  - 6大分類（terrain, water, cliff, building, interior, prop）
  - タイルパレットでのカテゴリフィルタ機能
  - _Requirements: 13.5_

- [ ] 21. AI生成結果の統合とエディタ連携
  - 生成タイルのサムネイル表示（32px/64px）
  - A/B比較ビューと採用ボタン
  - タイルパレットへの自動統合機能
  - _Requirements: 13.9_

- [ ] 22. パフォーマンス最適化実装
  - チャンク分割レンダリング（32×32タイル単位）
  - 可視領域カリングとバッチ描画
  - メモリリーク検出とテクスチャガベージコレクション
  - _Requirements: 11.1, 11.2_

- [ ] 23. プラグインAPI基盤（α版）
  - カスタムイベントノード登録システム
  - プラグインローダーとツールボックス表示
  - サンプルプラグイン（ShakeScreenノード）の実装
  - _Requirements: 12.1, 12.2_

- [ ] 24. テストスイート実装
  - 主要機能のユニットテスト（Vitest）
  - E2Eテストシナリオ（Playwright）: プロジェクト作成→マップ編集→プレビュー→エクスポート
  - AI生成パイプラインのテスト（モック使用）
  - パフォーマンステスト（LCP < 2.5s）
  - _Requirements: 14.1, 14.2_

- [ ] 25. CI/CD設定と品質保証
  - GitHub Actions設定（型チェック、テスト実行）
  - E2Eテストの自動化
  - パフォーマンス監視とアラート設定
  - _Requirements: 14.1, 14.2_